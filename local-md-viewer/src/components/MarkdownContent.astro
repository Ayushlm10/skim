---
import { marked } from 'marked';
import type { MarkdownFile } from '../lib/files';
import { formatDate, formatFileSize } from '../lib/files';

interface Props {
  file: MarkdownFile;
}

const { file } = Astro.props;

// Configure marked for better rendering
marked.setOptions({
  gfm: true,
  breaks: true,
});

const html = await marked.parse(file.content);
---

<article class="document">
  <header class="document-header">
    <div class="document-meta">
      <span class="meta-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        {formatDate(file.modifiedAt)}
      </span>
      <span class="meta-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
          <path d="M14 2v6h6"/>
        </svg>
        {formatFileSize(file.size)}
      </span>
      <span class="meta-item path">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
        </svg>
        {file.relativePath}
      </span>
    </div>
    <h1 class="document-title">{file.title}</h1>
  </header>
  
  <div class="document-paper">
    <div class="prose" set:html={html} />
  </div>
</article>

<style>
  .document {
    padding: 48px;
    max-width: 900px;
    margin: 0 auto;
  }

  .document-header {
    margin-bottom: 32px;
  }

  .document-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 16px;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text-muted);
  }

  .meta-item svg {
    width: 14px;
    height: 14px;
  }

  .meta-item.path {
    font-family: var(--font-mono);
    font-size: 12px;
  }

  .document-title {
    font-family: var(--font-display);
    font-size: 42px;
    font-weight: 500;
    color: var(--text-primary);
    line-height: 1.2;
    letter-spacing: -0.02em;
  }

  .document-paper {
    background: var(--bg-paper);
    color: var(--text-on-paper);
    border-radius: 4px;
    box-shadow: var(--shadow-paper);
    padding: 64px 72px;
    position: relative;
  }

  /* Paper edge effect */
  .document-paper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(
      90deg,
      var(--accent) 0%,
      var(--accent-dim) 50%,
      var(--accent) 100%
    );
    border-radius: 4px 4px 0 0;
  }

  /* Prose styling */
  .prose {
    font-family: var(--font-body);
    font-size: 17px;
    line-height: 1.75;
    color: var(--text-on-paper);
  }

  .prose :global(h1),
  .prose :global(h2),
  .prose :global(h3),
  .prose :global(h4),
  .prose :global(h5),
  .prose :global(h6) {
    font-family: var(--font-display);
    color: var(--text-on-paper);
    margin-top: 2em;
    margin-bottom: 0.75em;
    line-height: 1.3;
    font-weight: 600;
  }

  .prose :global(h1) {
    font-size: 2.25em;
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.3em;
    margin-top: 0;
  }

  .prose :global(h2) {
    font-size: 1.75em;
    border-bottom: 1px solid #e0dcd4;
    padding-bottom: 0.25em;
  }

  .prose :global(h3) {
    font-size: 1.4em;
  }

  .prose :global(h4) {
    font-size: 1.2em;
  }

  .prose :global(p) {
    margin-bottom: 1.25em;
  }

  .prose :global(a) {
    color: #8b6914;
    text-decoration: underline;
    text-decoration-color: rgba(139, 105, 20, 0.3);
    text-underline-offset: 3px;
    transition: all 0.15s ease;
  }

  .prose :global(a:hover) {
    text-decoration-color: #8b6914;
  }

  .prose :global(strong) {
    font-weight: 600;
    color: #1a1815;
  }

  .prose :global(em) {
    font-style: italic;
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1.25em;
    padding-left: 1.75em;
  }

  .prose :global(li) {
    margin-bottom: 0.5em;
  }

  .prose :global(li::marker) {
    color: var(--accent-dim);
  }

  .prose :global(blockquote) {
    border-left: 4px solid var(--accent);
    margin: 1.5em 0;
    padding: 1em 1.5em;
    background: var(--bg-paper-warm);
    font-style: italic;
    color: var(--text-on-paper-secondary);
  }

  .prose :global(blockquote p:last-child) {
    margin-bottom: 0;
  }

  .prose :global(code) {
    font-family: var(--font-mono);
    font-size: 0.9em;
    background: #f0ebe3;
    padding: 0.2em 0.4em;
    border-radius: 4px;
    color: #6b5c3e;
  }

  .prose :global(pre) {
    background: #2a2825;
    color: #e8e6e3;
    padding: 1.25em 1.5em;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5em 0;
    font-size: 0.9em;
    line-height: 1.6;
  }

  .prose :global(pre code) {
    background: none;
    padding: 0;
    color: inherit;
    font-size: inherit;
  }

  .prose :global(hr) {
    border: none;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      #d4cec4 20%,
      #d4cec4 80%,
      transparent
    );
    margin: 2.5em 0;
  }

  .prose :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5em 0;
    font-size: 0.95em;
  }

  .prose :global(th),
  .prose :global(td) {
    padding: 0.75em 1em;
    border: 1px solid #e0dcd4;
    text-align: left;
  }

  .prose :global(th) {
    background: var(--bg-paper-warm);
    font-weight: 600;
    font-family: var(--font-display);
  }

  .prose :global(tr:nth-child(even)) {
    background: rgba(0, 0, 0, 0.02);
  }

  .prose :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1.5em 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Task lists */
  .prose :global(input[type="checkbox"]) {
    margin-right: 0.5em;
    accent-color: var(--accent);
  }

  @media (max-width: 768px) {
    .document {
      padding: 24px 16px;
    }

    .document-paper {
      padding: 32px 24px;
    }

    .document-title {
      font-size: 32px;
    }
  }
</style>
