---
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import { getFileTree, getMarkdownFiles } from '../lib/files';

const tree = await getFileTree();
const files = await getMarkdownFiles();
const recentFiles = files
  .sort((a, b) => b.modifiedAt.getTime() - a.modifiedAt.getTime())
  .slice(0, 6);
---

<Layout title="Home">
  <div class="app">
    <Sidebar tree={tree} />
    
    <main class="main-content">
      <div class="welcome">
        <div class="welcome-header">
          <h1 class="welcome-title">Welcome to Folio</h1>
          <p class="welcome-subtitle">Your local markdown document viewer</p>
        </div>
        
        <div class="stats">
          <div class="stat-card">
            <span class="stat-value">{files.length}</span>
            <span class="stat-label">Documents</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">{tree.filter(n => n.type === 'directory').length}</span>
            <span class="stat-label">Folders</span>
          </div>
        </div>
        
        {recentFiles.length > 0 ? (
          <section class="recent-section">
            <h2 class="section-title">Recently Modified</h2>
            <div class="recent-grid">
              {recentFiles.map(file => (
                <a href={`/view/${encodeURIComponent(file.relativePath)}`} class="file-card">
                  <div class="file-card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                      <path d="M14 2v6h6"/>
                      <path d="M16 13H8"/>
                      <path d="M16 17H8"/>
                      <path d="M10 9H8"/>
                    </svg>
                  </div>
                  <div class="file-card-content">
                    <h3 class="file-card-title">{file.title}</h3>
                    <p class="file-card-path">{file.relativePath}</p>
                    <time class="file-card-date">
                      {file.modifiedAt.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                      })}
                    </time>
                  </div>
                </a>
              ))}
            </div>
          </section>
        ) : (
          <div class="empty-state">
            <div class="empty-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <path d="M14 2v6h6"/>
              </svg>
            </div>
            <h2 class="empty-title">No documents found</h2>
            <p class="empty-text">
              Create a <code>docs</code> folder in your project directory or set the <code>DOCS_DIR</code> environment variable to point to your markdown files.
            </p>
          </div>
        )}
        
        <section class="help-section">
          <h2 class="section-title">Quick Start</h2>
          <div class="help-cards">
            <div class="help-card">
              <h3>Set Documents Directory</h3>
              <p>Set the <code>DOCS_DIR</code> environment variable to your markdown files location:</p>
              <pre><code>DOCS_DIR=/path/to/docs bun run dev</code></pre>
            </div>
            <div class="help-card">
              <h3>Or Use Default</h3>
              <p>Create a <code>docs</code> folder in your project root and add your markdown files there.</p>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>
</Layout>

<style>
  .app {
    display: flex;
    min-height: 100vh;
  }

  .main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    background: var(--bg-deep);
  }

  .welcome {
    padding: 64px 48px;
    max-width: 1000px;
    margin: 0 auto;
  }

  .welcome-header {
    margin-bottom: 48px;
    text-align: center;
  }

  .welcome-title {
    font-family: var(--font-display);
    font-size: 56px;
    font-weight: 500;
    color: var(--text-primary);
    letter-spacing: -0.02em;
    margin-bottom: 12px;
  }

  .welcome-subtitle {
    font-size: 18px;
    color: var(--text-secondary);
  }

  .stats {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 64px;
  }

  .stat-card {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px 40px;
    text-align: center;
  }

  .stat-value {
    display: block;
    font-family: var(--font-display);
    font-size: 48px;
    font-weight: 600;
    color: var(--accent);
    line-height: 1;
    margin-bottom: 8px;
  }

  .stat-label {
    font-size: 14px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .section-title {
    font-family: var(--font-display);
    font-size: 24px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 24px;
  }

  .recent-section {
    margin-bottom: 64px;
  }

  .recent-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .file-card {
    display: flex;
    gap: 16px;
    padding: 20px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    transition: all 0.2s ease;
  }

  .file-card:hover {
    border-color: var(--accent-dim);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  .file-card-icon {
    width: 44px;
    height: 44px;
    background: var(--accent-glow);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .file-card-icon svg {
    width: 22px;
    height: 22px;
    color: var(--accent);
  }

  .file-card-content {
    flex: 1;
    min-width: 0;
  }

  .file-card-title {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-card-path {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-card-date {
    font-size: 12px;
    color: var(--text-secondary);
  }

  .empty-state {
    text-align: center;
    padding: 64px 32px;
    background: var(--bg-surface);
    border: 1px dashed var(--border);
    border-radius: 16px;
    margin-bottom: 48px;
  }

  .empty-icon {
    width: 72px;
    height: 72px;
    background: var(--bg-elevated);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
  }

  .empty-icon svg {
    width: 36px;
    height: 36px;
    color: var(--text-muted);
  }

  .empty-title {
    font-family: var(--font-display);
    font-size: 24px;
    color: var(--text-primary);
    margin-bottom: 12px;
  }

  .empty-text {
    color: var(--text-secondary);
    max-width: 400px;
    margin: 0 auto;
  }

  .empty-text code {
    font-family: var(--font-mono);
    background: var(--bg-elevated);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
  }

  .help-section {
    margin-top: 48px;
  }

  .help-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .help-card {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
  }

  .help-card h3 {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 12px;
  }

  .help-card p {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 12px;
  }

  .help-card code {
    font-family: var(--font-mono);
    background: var(--bg-elevated);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
  }

  .help-card pre {
    background: var(--bg-elevated);
    padding: 12px 16px;
    border-radius: 8px;
    overflow-x: auto;
    margin: 0;
  }

  .help-card pre code {
    background: none;
    padding: 0;
    font-size: 13px;
    color: var(--accent);
  }

  @media (max-width: 768px) {
    .main-content {
      margin-left: 0;
    }

    .welcome {
      padding: 32px 16px;
    }

    .welcome-title {
      font-size: 36px;
    }

    .stats {
      flex-direction: column;
    }
  }
</style>
